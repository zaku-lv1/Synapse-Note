<%- include('partials/header') %>

<div class="form-container quiz-taking">
    <form action="/quiz/submit" method="POST" id="quiz-form">
        <h2 class="page-title"><%= quiz.title %></h2>
                <% if (locals.error) { %>
            <div class="error-message"><%= error %></div>
        <% } %>
        
        <!-- 
            „Åì„ÅÆ„Éï„Ç©„Éº„É†„ÅØ2„Å§„ÅÆ„Ç±„Éº„Çπ„Åß‰Ωø„Çè„Çå„Åæ„Åô:
            1. isDraft=false (‰øùÂ≠òÊ∏à„Åø„ÇØ„Ç§„Ç∫): quizId„ÇíÊåÅ„Å§
            2. isDraft=true (AIÁîüÊàêÁõ¥Âæå„ÅÆ‰∏ãÊõ∏„Åç): quizId„ÇíÊåÅ„Åü„Åö„ÄÅÂÖ®ÂïèÈ°å„Éá„Éº„Çø„ÇíÊåÅ„Å§
        -->
        <% if (!isDraft && quiz.id) { %>
            <input type="hidden" name="quizId" value="<%= quiz.id %>">
        <% } else { %>
            <input type="hidden" name="draftQuizData" value='<%- JSON.stringify(quiz) %>'>
        <% } %>

        <div class="question-list">
            <% quiz.questions.forEach((q, index) => { %>
                <div class="question-card">
                    <div class="question-header">
                        <h4>ÂïèÈ°å <%= index + 1 %></h4>
                        <span>(<%= q.points %>ÁÇπ)</span>
                    </div>
                    <p class="question-text"><%- q.question.replace(/\n/g, '<br>') %></p>
                    
                    <div class="answer-input-group">
                        <% if (q.type === 'multiple_choice') { %>
                            <div class="options-group">
                                <% q.options.forEach((option, optIndex) => { %>
                                    <label class="option-label">
                                        <input type="radio" name="answers[<%= index %>]" value="<%= option %>">
                                        <span><%= option %></span>
                                    </label>
                                <% }); %>
                            </div>
                        <% } else if (q.type === 'short_answer') { %>
                            <input type="text" name="answers[<%= index %>]" placeholder="Ëß£Á≠î„ÇíÂÖ•Âäõ" autocomplete="off">
                        <% } else { %>
                            <textarea name="answers[<%= index %>]" rows="4" placeholder="Ëß£Á≠î„ÇíË®òËø∞" autocomplete="off"></textarea>
                        <% } %>
                    </div>
                </div>
            <% }); %>
        </div>

        <div class="form-actions">
            <button type="submit" class="button" id="submit-quiz-btn">
                <span class="btn-text">Êé°ÁÇπ„Åô„Çã</span>
                <span class="btn-icon">üìù</span>
            </button>
        </div>
    </form>
</div>

<!-- Loading overlay for quiz grading -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const quizForm = document.getElementById('quiz-form');
    const submitBtn = document.getElementById('submit-quiz-btn');
    
    if (quizForm && submitBtn) {
        quizForm.addEventListener('submit', function(e) {
            // Show grading loading screen
            if (window.QuizLoading) {
                window.QuizLoading.showGrading();
            }
            
            // Add loading state to button
            submitBtn.classList.add('loading');
            submitBtn.disabled = true;
            
            // Update button text
            const btnText = submitBtn.querySelector('.btn-text');
            if (btnText) {
                btnText.textContent = 'Êé°ÁÇπ‰∏≠...';
            }
        });
    }
});
</script>

<%- include('partials/footer') %>